<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css">


  <style>
    html,
    body {
      background: rgba(0, 0, 0, 0.05);
      height: 100%;
      width: 100%;
    }

    #inbox {
      height: 100vh;
      margin: 0 20%;
      padding: 0 5%;
      background: white !important;
    }

    .mList {
      height: 330px;
    }

    .btn-compose {
      position: absolute;
      right: 30%;
      bottom: 5%;
      z-index: 5;
    }

    .boundary {
      margin-top: 15px;
    }
    .label{
      width: 40%;
    }
    .sent {
      float: right;
      text-align: center;
    }
  
  </style>
</head>


<body>
  <!-- the modal -->
  <div class="ui tiny  modal " id="compose_message">
    <div class="header">
      Compose Message
    </div>

    <div class=" scrolling content ">
      <div class="ui fluid form">
        <div class="field">
          <label>From:</label>
          <input type="text" id="username" placeholder="Username">
        </div>
        <div class="field">
          <label>To:</label>
          <input type="text" id="receiver" placeholder="Receiver Name">
        </div>
        <div class="field">

          <textarea id="myMessage" placeholder="start typing here..."></textarea>
        </div>
      </div>
    </div>
    <div class="actions">
      <div class="ui positive send  button">
        Send
      </div>
      <div id="clr-msg" class="ui left deny icon red  button ">
        <span>Cancel</span>
      </div>
    </div>
  </div>
  <!-- end of modal -->
  <div id="inbox">
    <div class=" mList ui">
      <br>
      <center>
        <h2>Inbox</h2>
      </center>
      <hr>
      <div class="messages">

      </div>
      <div class="ui bottom attached tab segment" data-tab="third">
        Third
      </div>
      <div class="ui tiny  modal " id="register">
        <div class="header">
          Enter Username
        </div>

        <div class=" scrolling content ">
          <div class="card">

            <div class="username Form ui form content">

              <div class="field">
                <input type="text" id="Myusername" placeholder="Enter your username to start">
              </div>
              <br>
              <center>
                <button class="ui reg-btn positive button">
                  <i class="icon user"></i>
                  Save
                </button>
              </center>
            </div>
          </div>
        </div>
      </div>


      <br>
    </div>

    <button class="ui massive btn-compose circular google plus icon button">
      <i class="comment icon"></i>
    </button>
  </div>
  <!-- scripts -->
  <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js"></script>
  <script>
    $(document).ready(function () {
      var socket = io();

      $('.btn-compose').attr('disabled', true)
      $('.reg-btn').attr('disabled', true)
      var username = "anonymous";

      $("#Myusername").change(function () {
        if ($(this).val() != "") {
          $('.reg-btn').attr('disabled', false)
          username =  $(this).val();
        }
      });

      $('.reg-btn').click(function () {
        $('#register').modal('hide');
        $('.btn-compose').attr('disabled', false)
        $('#username').attr('disabled', true)
        $("#username").val(username);

      })

      $('#register').modal('setting', 'closable', false).modal('show');

      $('.btn-compose').click(function () {
        $('#compose_message').modal('show');
      });


      $('.menu .item').tab();
      $('.send').click(function () {

        var myMsg = $('#myMessage').val();
        var receiver = $("#receiver").val();
        if (receiver == "") {
          receiver = 'group message'
        }


        socket.emit("chat message", { sender: username, receiver: receiver, message: myMsg });

        Swal.fire({
          type: 'success',
          title: 'Sent Successfully!',
          backdrop: 'rgba(0, 0, 0, 0.85)'
        });

        $('.messages').append($('<div>', {
          class: "sent big ui right pointing green basic label"
        }).text(myMsg).css("margin-top", "10px", "padding", "5px"), $("<br>"), $("<br>"), $("<br>"));

        $('#myMessage').val('');
        $('#receiver').val('');


      });

      socket.on("chat message", function (msg) {
       console.log(msg)
        if (msg.receiver == 'group message') {
          $('.messages').append($('<div>', {
            class: "rcv ui big left pointing red basic label"
          }).text("group:  "+msg.message).css("margin-top", "10px"), $("<br>"));
        }else if(msg.receiver == username){
          $('.messages').append($('<div>', {
            class: "rcv ui big left pointing red basic label"
          }).text(msg.sender+" :  "+msg.message).css("margin-top", "10px"), $("<br>"));
        }

      });


    });
  </script>
</body>

</html>